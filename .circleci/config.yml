version: 2
jobs:
 build:
   docker:
     - image: python:3.7
   branches:
      only:
        - master
   steps:
     - run: 
        name: Pull project
        command: |
          ssh -o "StrictHostKeyChecking no" ec2-user@ec2-35-158-219-60.eu-central-1.compute.amazonaws.com "cd WeLeave && docker-compose stop && git pull"
          ssh -o "StrictHostKeyChecking no" ec2-user@ec2-35-158-219-60.eu-central-1.compute.amazonaws.com "cd WeLeave && docker rmi -f `docker images -q`"
          ssh -o "StrictHostKeyChecking no" ec2-user@ec2-35-158-219-60.eu-central-1.compute.amazonaws.com "cd WeLeave && docker-compose up --build --detach"
